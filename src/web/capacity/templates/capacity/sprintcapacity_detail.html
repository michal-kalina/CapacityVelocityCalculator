{% extends "main.html" %}

{% block content %}
    {% if output %}
    <p>Sprint: {{ output.sprint_name }}</p>
    <a id="add" href="{% url 'capacity:update' output.sprint_id %}" type="button" class="btn btn-primary">Edit <i class="bi bi-pencil" style="font-size: 1rem;"></i></a>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th><i class="bi bi-people" style="font-size: 2rem;"></i></th>
                {% for d in output.items.0.data %}
                <th>{{ d.date|date:"Y-m-d" }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for item in output.items %}
            <tr>
                <td>{{ item.person_name }}</td>
                {% for d in item.data %}
                <td>
                    <form id="presence-post" data-id="{{d.id}}" type="post">
                        {% csrf_token %}
                        <input name="id" type="hidden" value="{{ d.id }}" />
                        {% if d.presence == "Y" %}
                        <input name="presence" type="hidden" value="Y" />
                        {% else %}
                        <input name="presence" type="hidden" value="N" />
                        {% endif %}
                        <input name="date" type="hidden" value="{{ d.date|date:"Y-m-d" }}" />
                        {% if d.presence == "Y" %}
                        <i class="bi bi-person-check" style="font-size: 2rem;"></i>
                        {% else %}
                        <i class="bi bi-person-x" style="font-size: 2rem;"></i>
                        {% endif %}
                    </form>
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No data is available.</p>
    {% endif %}
{% endblock %}


{% block script_section %}
<script type="text/javascript">
//post-form
$(document).on('click', '#presence-post', function (event) {
    // Make sure the page will not reload
    event.preventDefault();
    const form = event.currentTarget;
    const id = form.getAttribute("data-id");
    const presence = Helpers.getFormInputValueByAttributeName(form, "presence")
    const date = Helpers.getFormInputValueByAttributeName(form, "date")
    const csrfmiddlewaretoken = Helpers.getFormInputValueByAttributeName(form, "csrfmiddlewaretoken")
    const data = {
        id: id,
        presence: presence,
        date: date,
        csrfmiddlewaretoken: csrfmiddlewaretoken
    };
    Helpers.post('update/', data);
});
</script>
{% endblock %}